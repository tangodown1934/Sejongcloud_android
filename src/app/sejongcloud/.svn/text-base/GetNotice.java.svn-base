package exam.AndroidFirst;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URL;
import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.json.JSONArray;

import android.os.Bundle;
import android.text.Html;
import android.util.Log;
import android.widget.TextView;

public class GetNotice {
    static ArrayList<NoticeResult> result;
	
	public static ArrayList<NoticeResult> getNotice(String address){
		Pattern mPattern=Pattern.compile("handle=(.*)&board_id");
		Matcher mTemp = mPattern.matcher(address); // ºÎ°¡Á¤ µû¿È 
		String handle="";
		if(mTemp.find()){
			handle=mTemp.group(1);
		}
		result=new ArrayList<NoticeResult>();
		TextView text;
		String contents=null;
		String line=null;
		String notice="";
		String findStr=null;
		String object_subject[] = new String[12];
		String object_info[] = new String[12];
		String object_url[] = new String[12];
		NoticeResult mNotice=new NoticeResult();
		class noticeCLASS {
			String number;
			String subject;
			String editor;
			String date;
			String search_num;
			String url_num;
		}
		noticeCLASS info= new noticeCLASS();
		
		int object_count=0;
		mNotice.handle=handle;
		
	    try { // notice 
			URL url= new URL(address);
			InputStreamReader mStream=new InputStreamReader(url.openStream(), "EUC-KR");
			BufferedReader input = new BufferedReader(mStream);
			Pattern p1 = Pattern.compile("<td class='k2_list_cnt'>(.*)&nbsp;");
			Pattern p2 = Pattern.compile("'"+handle+"','(.*)','N','N','','"+handle+"'\\);>(.*)&");
			int count=0;
				while ( (line = input.readLine()) != null){
					Matcher m1 = p1.matcher(line); // ºÎ°¡Á¤º¸ µû¿È 
					Matcher m2 = p2.matcher(line); // Á¦¸ñ µû¿È 
					if(m1.find()){
						findStr=m1.group(1);
						//Log.d("m1 group(1): ","result "+findStr);
		 				//notice = notice + findit + "\n";
		 				if(count % 5 == 0)
		 					info.number=findStr + " ";	
		 				else if(count % 5 == 2)
		 					info.editor=findStr + " ";
		 				else if(count % 5 == 3)
		 					info.date=findStr + " ";
		 				else if(count % 5 == 4){
		 					info.search_num=findStr + " ";//"No." + info.number + " Date."+info.date
		 					object_subject[object_count]=info.subject;
		 					object_info[object_count]=info.date;
		 					object_url[object_count]=info.url_num;
		 					
		 					object_count++;	
		 				}
		 				else{}
		 				count++;	
					}
					else if(m2.find()){
						findStr=m2.group(2);
						//Log.d("m2 group(2): ","result "+findStr);
						info.url_num=m2.group(1);
						info.subject=findStr + " ";
		 				count++;
					}
					else
						continue;
				}
		} catch (Exception e){;}
	    
	    
		for(int i=0; i < object_count ; i++){
			mNotice.new_object_subject= object_subject[i];
			mNotice.new_object_info = object_info[i];
			mNotice.new_object_url = object_url[i];
			mNotice.handle=handle;
			result.add(mNotice);
			mNotice=new NoticeResult();
		}
		return result;
	}
}
